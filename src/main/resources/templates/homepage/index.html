<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trang chủ - Đặt món ngay!</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/css/index.css" />
</head>
<style>
  .category-scroll {
    display: flex;
    justify-content: center;
    overflow-x: auto;
    gap: 1rem;
    padding: 0.8rem 1rem;
    margin-bottom: 1.5rem;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    -ms-overflow-style: none;

    /* Xóa nền trắng + shadow */
    background: transparent;
    box-shadow: none;
    border-radius: 0;
  }

  .category-scroll::-webkit-scrollbar {
    display: none;
  }


  .category-item {
    flex: 0 0 auto;
    width: 90px;
    text-align: center;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 14px;

    /* Cho nền trong suốt để trùng với màu nền ngoài */
    background: transparent;

    transition: all 0.25s ease;
    box-shadow: none;
    /* bỏ bóng nếu không muốn thấy khung */
  }


  .category-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
  }

  /* Ảnh tròn */
  .category-item img {
    width: 65px;
    height: 65px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid transparent;
    transition: all 0.3s ease;
  }

  .category-item:hover img {
    border-color: #ee4d2d;
    transform: scale(1.05);
  }

  /* Tên */
  .category-name {
    margin-top: 0.4rem;
    font-size: 0.8rem;
    font-weight: 600;
    color: #495057;
  }

  .category-item:hover .category-name {
    color: #ee4d2d;
  }

  .category-name a {
    text-decoration: none;
    color: inherit;
  }

  /* Active state */
  .category-item.active {
    background: linear-gradient(135deg, #ee4d2d, #ff6633);
    color: #fff;
    transform: translateY(-3px);
    box-shadow: 0 4px 14px rgba(238, 77, 45, 0.25);
  }

  .category-item.active img {
    border-color: #fff;
  }

  .category-item.active .category-name {
    color: #fff;
  }

  /* Hiệu ứng load */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .category-item {
    animation: fadeIn 0.5s ease;
  }

  /* Responsive cho màn nhỏ */
  @media (max-width: 576px) {
    .category-item {
      width: 75px;
    }

    .category-item img {
      width: 55px;
      height: 55px;
    }

    .category-name {
      font-size: 0.75rem;
    }

  }

  .banner-card {
    transition: transform .4s ease, box-shadow .4s ease;
    border-radius: 20px;
  }

  .banner-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
  }

  .banner-img {
    height: 230px;
    object-fit: cover;
    border-radius: 20px;
  }

  .banner-overlay {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0) 30%, rgba(0, 0, 0, 0.55) 100%);
    color: #fff;
    padding: 1.25rem;
    border-radius: 20px;
  }
</style>

<body>

  <div th:replace="~{user/fragments/_navbar :: navbar}"></div>
  <!-- ===== 3 Banner quảng cáo đầu trang ===== -->
  <section class="container my-4">
  <div class="row g-4">

    <!-- ==== Nổi bật ==== -->
    <div class="col-md-6" th:if="${featuredBanners}">
      <h5 class="mb-3 fw-bold text-danger">
        <i class="fas fa-fire me-1"></i> Nổi bật
      </h5>

      <div id="featuredCarousel" class="carousel slide shadow-lg rounded-4 overflow-hidden" data-bs-ride="carousel">
        <div class="carousel-inner">
          <div th:each="b,iter : ${featuredBanners}"
               class="carousel-item"
               th:classappend="${iter.index == 0} ? ' active'">
            <a th:href="@{/home(menu='hot-pick')}">
              <img th:src="@{'/images/dish/' + ${b.dish.pictureUrl}}"
                   class="d-block w-100 banner-img"
                   th:alt="${b.dish.name}">
              <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded-3 p-2">
                <h5 th:text="${b.dish.name}">Tên món</h5>
                <p class="small" th:text="${b.dish.description}">Mô tả</p>
              </div>
            </a>
          </div>
        </div>

        <!-- Nút điều khiển -->
        <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
        </button>
      </div>
    </div>

    <!-- ==== Ưu đãi ==== -->
    <div class="col-md-6" th:if="${promotionBanners}">
      <h5 class="mb-3 fw-bold text-warning">
        <i class="fas fa-tags me-1"></i> Ưu đãi
      </h5>

      <div id="promotionCarousel" class="carousel slide shadow-lg rounded-4 overflow-hidden" data-bs-ride="carousel">
        <div class="carousel-inner">
          <div th:each="b,iter : ${promotionBanners}"
               class="carousel-item"
               th:classappend="${iter.index == 0} ? ' active'">
            <a th:href="@{/home(menu='best-price')}">
              <img th:src="@{'/images/dish/' + ${b.dish.pictureUrl}}"
                   class="d-block w-100 banner-img"
                   th:alt="${b.dish.name}">
              <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded-3 p-2">
                <h5 th:text="${b.dish.name}">Tên món</h5>
                <p class="small" th:text="${b.dish.description}">Mô tả</p>
              </div>
            </a>
          </div>
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#promotionCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#promotionCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
        </button>
      </div>
    </div>

  </div>
</section>


  <!-- ===== /Banner ===== -->


  <div class="container py-4">
    <h3 class="text-center mb-4" style="color: #ee4d2d; font-weight: 700;">
      <i class="fas fa-utensils me-2" style="color: #ff6633;"></i>
      Danh mục món ăn
    </h3>
    <div class="category-scroll">
      <div class="category-item" th:each="row: ${categories}" th:data-category-id="${row.id}"
        th:classappend="${categoryId != null && categoryId == row.id} ? 'active' : ''">
        <img th:src="@{'/images/category/' + ${row.getPictureUrl()}}" th:alt="${row.name}">
        <div class="category-name">
          <a href="#" th:text="${row.name}" class="category-link"></a>
        </div>
      </div>
    </div>
  </div>

  <div class="main-header"
    style="background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%); border: 1px solid rgba(238, 77, 45, 0.1); box-shadow: 0 4px 15px rgba(238, 77, 45, 0.1);">
    <div class="container">
      <h1 style="text-align: center; color: #ee4d2d;" class="header-title"
        th:if="${search == null or search.isEmpty()} and ${categoryId == null} and ${menuType == null}">
        <i class="fas fa-gift me-2"></i>Danh sách ưu đãi
      </h1>
      <h1 class="header-title" style="color: #ee4d2d;" th:if="${search != null and !search.isEmpty()}">
        <i class="fas fa-search me-2"></i>Kết quả tìm kiếm cho '<span th:text="${search}"
          style="color: #ff6633;"></span>'
      </h1>
      <h1 class="header-title" style="color: #ee4d2d;" th:if="${categoryId != null}">
        <i class="fas fa-filter me-2"></i>Món ăn theo danh mục:
        <span th:each="cat : ${categories}" th:if="${cat.id == categoryId}" th:text="${cat.name}"
          style="color: #ff6633;"></span>
      </h1>
      <h1 class="header-title" style="color: #ee4d2d;" th:if="${menuType == 'best-price'}">
        <i class="fas fa-tags me-2"></i>Món ăn giá tốt - Giảm giá cao nhất
      </h1>
      <h1 class="header-title" style="color: #ee4d2d;" th:if="${menuType == 'nearby'}">
        <i class="fas fa-map-marker-alt me-2"></i>Món ngon gần bạn
      </h1>
      <h1 class="header-title" style="color: #ee4d2d;" th:if="${menuType == 'hot-pick'}">
        <i class="fas fa-fire me-2"></i>Món ngon hot pick - Được yêu thích
      </h1>
    </div>
  </div>

  <main class="container">

    <div class="results-info">
      <div class="results-count">
        <strong>KHU VỰC</strong>
        <span th:if="${#lists.isEmpty(dishes)}">0 kết quả</span>
        <span th:unless="${#lists.isEmpty(dishes)}" th:text="${#lists.size(dishes)} + ' kết quả'">1086 kết quả</span>
      </div>
      <select class="sort-dropdown">
        <option>Tất cả</option>
        <option>Giá thấp đến cao</option>
        <option>Giá cao đến thấp</option>
        <option>Đánh giá cao</option>
        <option>Bán chạy</option>
      </select>
    </div>

    <div class="dishes-grid">
      <th:block th:each="restaurantEntry : ${dishesByRestaurant}">
        <div class="dish-card" th:each="dish : ${restaurantEntry.value}">
          <div class="dish-image-container">
            <img th:src="@{'/images/dish/' + ${dish.pictureUrl}}" class="dish-image" th:alt="${dish.name}">
            <div class="available-indicator"></div>
            <div class="favorite-badge" th:data-dish-id="${dish.id}">
              <i class="fas fa-heart"></i>
            </div>
            <div class="discount-badge">Giảm 20%</div>
          </div>

          <div class="dish-info">
            <h3 class="dish-name" th:text="${dish.name}">Cơm Rang Dương Châu</h3>
            <p class="restaurant-name" th:text="${restaurantEntry.key.name}">Nhà hàng ABC</p>

            <div class="dish-price">
              <span th:text="${#numbers.formatDecimal(dish.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">25,000đ</span>
              <span class="original-price"
                th:text="${#numbers.formatDecimal(dish.price * 1.25, 0, 'COMMA', 0, 'POINT')} + 'đ'">31,250đ</span>
            </div>

            <div class="dish-stats">
              <div class="rating-section">
                <div class="rating">
                  <i class="fas fa-star"></i> 4.5
                </div>
              </div>
              <div class="sold-count">
                Đã bán 150+
              </div>
            </div>

            <div class="add-to-cart-section">
              <a th:href="@{/dish/{id}(id=${dish.id})}" class="view-btn">
                <i class="fas fa-eye me-1"></i> Xem
              </a>
              <form th:action="@{/cart/add}" method="POST" class="add-to-cart-form" style="display: inline-block;">
                <input type="hidden" name="dishId" th:value="${dish.id}" />
                <input type="hidden" name="quantity" value="1" />
                <button type="button" class="btn add-cart-btn add-to-cart-btn" th:data-dish-id="${dish.id}">
                  <i class="fas fa-plus"></i> Thêm
                </button>
              </form>
            </div>
          </div>
        </div>
      </th:block>
    </div>

    <div th:if="${#maps.isEmpty(dishesByRestaurant)}" class="empty-state">
      <i class="fas fa-utensils"></i>
      <h4>Không tìm thấy món ăn phù hợp</h4>
      <p>Thử thay đổi bộ lọc hoặc tìm kiếm với từ khóa khác</p>
      <button class="btn btn-primary">
        <i class="fas fa-redo me-2"></i>Tìm kiếm lại
      </button>
    </div>
  </main>

  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050">
    <div id="add-to-cart-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header bg-success text-white">
        <i class="fas fa-shopping-cart me-2"></i>
        <strong class="me-auto">Thành công</strong>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
      </div>
      <div class="toast-body">
        Đã thêm món ăn vào giỏ hàng!
      </div>
    </div>

    <div id="favorite-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header bg-danger text-white">
        <i class="fas fa-heart me-2"></i>
        <strong class="me-auto">Yêu thích</strong>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
      </div>
      <div class="toast-body">
        Đã thêm món ăn vào danh sách yêu thích!
      </div>
    </div>
  </div>

  <nav th:if="${dishesPage.totalPages > 1}">
    <ul class="pagination">
      <li class="page-item" th:classappend="${dishesPage.first} ? 'disabled'">
        <a class="page-link"
          th:href="@{/home(page=${dishesPage.number - 1}, search=${search}, category=${categoryId}, menu=${menuType})}">
          <i class="fas fa-angle-left"></i>
        </a>
      </li>

      <li class="page-item" th:each="i : ${#numbers.sequence(0, dishesPage.totalPages - 1)}"
        th:classappend="${i == dishesPage.number} ? 'active'">
        <a class="page-link" th:href="@{/home(page=${i}, search=${search}, category=${categoryId}, menu=${menuType})}"
          th:text="${i + 1}">1</a>
      </li>

      <li class="page-item" th:classappend="${dishesPage.last} ? 'disabled'">
        <a class="page-link"
          th:href="@{/home(page=${dishesPage.number + 1}, search=${search}, category=${categoryId}, menu=${menuType})}">
          <i class="fas fa-angle-right"></i>
        </a>
      </li>
    </ul>
  </nav>


  <footer class="mt-5 bg-light pt-4 pb-4 border-top">
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <h6>Công ty</h6>
          <ul class="list-unstyled small">
            <li>Giới thiệu</li>
            <li>Trung tâm Trợ giúp</li>
            <li>Quy chế</li>
            <li>Điều khoản sử dụng</li>
            <li>Bảo mật thông tin</li>
          </ul>
        </div>
        <div class="col-md-3">
          <h6>Ứng dụng FoodDelivery</h6>
          <div class="d-flex gap-2">
            <img src="/images/logo/appstore.png" alt="App Store" height="40">
            <img src="/images/logo/googleplay.png" alt="Google Play" height="40">
          </div>
        </div>
        <div class="col-md-6 text-end small">
          <p>FoodDelivery © 2025</p>
          <p>Công ty CP Foody - Địa chỉ: 244 Cống Quỳnh, P. Phạm Ngũ Lão, Q.1, TP.HCM</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script th:src="@{/js/cart/cart.js}"></script>

  <script>
    // Favorite functionality
    document.querySelectorAll('.favorite-badge').forEach(badge => {
      badge.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        // Toggle favorite state
        const heart = this.querySelector('i');
        if (heart.classList.contains('fas')) {
          heart.classList.remove('fas');
          heart.classList.add('far');
          this.style.background = 'rgba(108, 117, 125, 0.8)';
        } else {
          heart.classList.remove('far');
          heart.classList.add('fas');
          this.style.background = 'rgba(238, 77, 45, 0.9)';

          // Show favorite toast
          const toast = new bootstrap.Toast(document.getElementById('favorite-toast'));
          toast.show();
        }
      });
    });

    // Dish card click handler (except for buttons)
    document.querySelectorAll('.dish-card').forEach(card => {
      card.addEventListener('click', function (e) {
        // Don't navigate if clicking on buttons or favorite badge
        if (e.target.closest('.add-cart-btn, .view-btn, .favorite-badge')) {
          return;
        }

        // Get dish ID and navigate to detail page
        const dishId = this.querySelector('[data-dish-id]')?.getAttribute('data-dish-id');
        if (dishId) {
          window.location.href = `/dish/${dishId}`;
        }
      });
    });

    // Category filter functionality
    document.querySelectorAll('.category-item').forEach(item => {
      item.addEventListener('click', function (e) {
        e.preventDefault();

        document.querySelectorAll('.category-item').forEach(cat => cat.classList.remove('active'));
        this.classList.add('active');

        const categoryId = this.getAttribute('data-category-id');
        window.location.href = `/home?category=${categoryId}`;
      });
    });

    // Sort dropdown functionality
    document.querySelector('.sort-dropdown').addEventListener('change', function () {
      console.log('Sort by:', this.value);
      // Implement sorting logic here
    });

  </script>

</body>

</html>