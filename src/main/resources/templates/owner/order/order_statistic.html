<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Danh s√°ch ƒë∆°n h√†ng</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #e0f7fa, #f1f8e9);
      min-height: 100vh;
    }
    .card {
      border: none;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    .table thead {
      background: linear-gradient(90deg, #42a5f5, #5c6bc0);
      color: white;
    }
    .table-hover tbody tr:hover {
      background-color: #f0f8ff;
      transition: 0.3s;
    }
    .dish-img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 12px;
      border: 2px solid #e0e0e0;
    }
    .search-box {
      max-width: 280px;
    }
  </style>
</head>
<body class="p-4">
<div class="container">
  <div class="card p-4">
    <h2 class="mb-4 text-center text-primary fw-bold">
      <i class="fa-solid fa-chart-line"></i> Th·ªëng k√™ ƒë∆°n h√†ng
    </h2>
    
    <!-- Th√¥ng tin nh√† h√†ng -->
    <div class="row mb-4" th:if="${restaurant}">
      <div class="col-12">
        <div class="alert alert-info">
          <h5 class="mb-2"><i class="fa-solid fa-store"></i> <span th:text="${restaurant.name}"></span></h5>
          <p class="mb-0"><i class="fa-solid fa-map-marker-alt"></i> <span th:text="${restaurant.address}"></span></p>
        </div>
      </div>
    </div>
    
    <!-- Th·ªëng k√™ t·ªïng quan -->
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="card bg-primary text-white">
          <div class="card-body text-center">
            <i class="fa-solid fa-receipt fa-2x mb-2"></i>
            <h4 th:text="${totalOrders}">0</h4>
            <p class="mb-0">T·ªïng ƒë∆°n h√†ng</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card bg-success text-white">
          <div class="card-body text-center">
            <i class="fa-solid fa-box fa-2x mb-2"></i>
            <h4 th:text="${totalItems}">0</h4>
            <p class="mb-0">T·ªïng s·∫£n ph·∫©m</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card bg-warning text-white">
          <div class="card-body text-center">
            <i class="fa-solid fa-dollar-sign fa-2x mb-2"></i>
            <h4 th:text="${#numbers.formatDecimal(totalRevenue, 0, 'COMMA', 0, 'POINT')}">0</h4>
            <p class="mb-0">T·ªïng doanh thu (VNƒê)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Toolbar -->
    <div class="d-flex flex-wrap justify-content-between mb-3 gap-2">
      <input id="searchInput" type="text" class="form-control search-box" placeholder="üîç T√¨m ki·∫øm m√≥n ƒÉn...">
      <button class="btn btn-outline-primary" onclick="sortTable(0)">
        <i class="fa-solid fa-arrow-down-a-z"></i> S·∫Øp x·∫øp theo M√£ ƒë∆°n
      </button>
    </div>

    <!-- Th√¥ng b√°o l·ªói -->
    <div th:if="${error}" class="alert alert-warning" role="alert">
      <i class="fa-solid fa-exclamation-triangle"></i> <span th:text="${error}"></span>
    </div>
    
    <!-- Th√¥ng b√°o kh√¥ng c√≥ d·ªØ li·ªáu -->
    <div th:if="${orderDetailList != null and orderDetailList.isEmpty()}" class="alert alert-info" role="alert">
      <i class="fa-solid fa-info-circle"></i> Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o cho nh√† h√†ng n√†y.
    </div>
    
    <!-- B·∫£ng chi ti·∫øt -->
    <div th:if="${orderDetailList != null and !orderDetailList.isEmpty()}">
      <h5 class="mb-3"><i class="fa-solid fa-list"></i> Chi ti·∫øt ƒë∆°n h√†ng</h5>
      <div class="table-responsive">
      <table id="orderTable" class="table table-hover align-middle text-center">
        <thead>
        <tr>
          <th scope="col">M√£ ƒë∆°n</th>
          <th scope="col">M√≥n ƒÉn</th>
          <th scope="col">H√¨nh ·∫£nh</th>
          <th scope="col">Ng∆∞·ªùi ƒë·∫∑t</th>
          <th scope="col">S·ªë l∆∞·ª£ng</th>
          <th scope="col">Gi√°</th>
          <th scope="col">Th√†nh ti·ªÅn</th>
          <th scope="col">Tr·∫°ng th√°i</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="row : ${orderDetailList}">
          <td th:text="${row.getOrder().getId()}"></td>
          <td th:text="${row.getDish().getName()}"></td>
          <td>
            <img th:src="@{'/images/dish/' + ${row.getDish().getPictureUrl()}}" alt="·∫¢nh m√≥n" class="dish-img">
          </td>
          <td th:text="${row.getOrder().getUser().getUsername()}"></td>
          <td th:text="${row.getQuantity()}"></td>
          <td th:text="${#numbers.formatDecimal(row.getDish().getPrice(), 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
          <td th:text="${#numbers.formatDecimal(row.getQuantity() * row.getDish().getPrice(), 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
          <td>
            <span class="badge bg-success px-3 py-2"
                  th:if="${row.getOrder().getOrderStatus().getName() == 'ƒê√£ duy·ªát'}"
                  data-bs-toggle="tooltip" title="ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c duy·ªát"
                  th:text="${row.getOrder().getOrderStatus().getName()}"></span>
            <span class="badge bg-warning text-dark px-3 py-2"
                  th:if="${row.getOrder().getOrderStatus().getName() == 'Ch·ªù x·ª≠ l√Ω'}"
                  data-bs-toggle="tooltip" title="ƒê∆°n h√†ng ƒëang ch·ªù x·ª≠ l√Ω"
                  th:text="${row.getOrder().getOrderStatus().getName()}"></span>
            <span class="badge bg-danger px-3 py-2"
                  th:if="${row.getOrder().getOrderStatus().getName() == 'ƒê√£ h·ªßy'}"
                  data-bs-toggle="tooltip" title="ƒê∆°n h√†ng ƒë√£ b·ªã h·ªßy"
                  th:text="${row.getOrder().getOrderStatus().getName()}"></span>
            <span class="badge bg-info px-3 py-2"
                  th:if="${row.getOrder().getOrderStatus().getName() != 'ƒê√£ duy·ªát' && row.getOrder().getOrderStatus().getName() != 'Ch·ªù x·ª≠ l√Ω' && row.getOrder().getOrderStatus().getName() != 'ƒê√£ h·ªßy'}"
                  th:text="${row.getOrder().getOrderStatus().getName()}"></span>
          </td>
        </tr>
        </tbody>
      </table>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Tooltip init
  const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
  const tooltipList = [...tooltipTriggerList].map(el => new bootstrap.Tooltip(el))

  // T√¨m ki·∫øm
  document.getElementById('searchInput').addEventListener('keyup', function () {
    let filter = this.value.toLowerCase();
    let rows = document.querySelectorAll("#orderTable tbody tr");
    rows.forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(filter) ? "" : "none";
    });
  });

  // S·∫Øp x·∫øp
  function sortTable(colIndex) {
    let table = document.getElementById("orderTable");
    let switching = true, shouldSwitch, i;
    while (switching) {
      switching = false;
      let rows = table.rows;
      for (i = 1; i < (rows.length - 1); i++) {
        shouldSwitch = false;
        let x = rows[i].getElementsByTagName("TD")[colIndex];
        let y = rows[i + 1].getElementsByTagName("TD")[colIndex];
        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
          shouldSwitch = true;
          break;
        }
      }
      if (shouldSwitch) {
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
      }
    }
  }
</script>
</body>
</html>
