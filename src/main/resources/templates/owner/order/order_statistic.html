<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chi ti·∫øt ƒë∆°n h√†ng</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #e0f7fa, #f1f8e9);
      min-height: 100vh;
    }
    .card {
      border: none;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    .table thead {
      background: linear-gradient(90deg, #42a5f5, #5c6bc0);
      color: white;
    }
    .table-hover tbody tr:hover {
      background-color: #f0f8ff;
      transition: 0.3s;
    }
    .dish-img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 12px;
      border: 2px solid #e0e0e0;
    }
    .search-box {
      max-width: 280px;
    }

    .total-box {
      background: linear-gradient(90deg, #ffebee, #ffcdd2);
      border: 2px solid #e57373;
      border-radius: 12px;
      padding: 15px 20px;
      display: inline-block;
      min-width: 280px;
      box-shadow: 0 4px 12px rgba(229, 115, 115, 0.3);
    }

    .total-box h5 {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 700;
      color: #b71c1c;
    }

    .total-box span {
      font-size: 1.6rem;
      font-weight: 800;
      color: #d32f2f;
    }
  </style>
</head>
<body class="p-4">
<div class="container">
  <div class="card p-4">
    <h2 class="mb-4 text-center text-primary fw-bold">
      <i class="fa-solid fa-receipt"></i> Chi ti·∫øt ƒë∆°n h√†ng
    </h2>
    <!-- Toolbar -->
    <div class="d-flex flex-wrap justify-content-between mb-3 gap-2">
      <input id="searchInput" type="text" class="form-control search-box" placeholder="üîç T√¨m ki·∫øm m√≥n ƒÉn...">
      <button class="btn btn-outline-primary" onclick="sortTable(1)">
        <i class="fa-solid fa-arrow-down-a-z"></i> S·∫Øp x·∫øp theo T√™n m√≥n
      </button>
    </div>
    <div class="mt-3 text-end">
      <div class="total-box">
        <h5>
          <i class="me-2"></i> T·ªïng S·ªë s·∫£n ph·∫©m:
          <span th:text="${sum}"></span>
        </h5>
      </div>
    </div>
    
    <!-- Th√¥ng b√°o kh√¥ng c√≥ d·ªØ li·ªáu -->
    <div th:if="${orderDetailList != null and orderDetailList.isEmpty()}" class="alert alert-info" role="alert">
      <i class="fa-solid fa-info-circle"></i> ƒê∆°n h√†ng n√†y ch∆∞a c√≥ chi ti·∫øt.
    </div>
    
    <!-- B·∫£ng chi ti·∫øt -->
    <div th:if="${orderDetailList != null and !orderDetailList.isEmpty()}">
      <h5 class="mb-3"><i class="fa-solid fa-list"></i> Chi ti·∫øt ƒë∆°n h√†ng</h5>
      <div class="table-responsive">
      <table id="orderTable" class="table table-hover align-middle text-center">
        <thead>
        <tr>
          <th scope="col">M√£ ƒë∆°n</th>
          <th scope="col">M√≥n ƒÉn</th>
          <th scope="col">H√¨nh ·∫£nh</th>
          <th scope="col">Ng∆∞·ªùi ƒë·∫∑t</th>
          <th scope="col">S·ªë l∆∞·ª£ng</th>
          <th scope="col">Gi√°</th>
          <th scope="col">Th√†nh ti·ªÅn</th>
          <th scope="col">Tr·∫°ng th√°i</th>
          <th scope="col">Xem chi ti·∫øt</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="row : ${orderDetailList}">
          <td th:text="${row.getOrder().getId()}"></td>
          <td th:text="${row.getDish().getName()}"></td>
          <td>
            <img th:src="@{'/images/dish/' + ${row.getDish().getPictureUrl()}}" alt="·∫¢nh m√≥n" class="dish-img">
          </td>
          <td th:text="${row.getOrder().getUser().getUsername()}"></td>
          <td th:text="${row.getQuantity()}"></td>
          <td th:text="${#numbers.formatDecimal(row.getDish().getPrice(), 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
          <td th:text="${#numbers.formatDecimal(row.getQuantity() * row.getDish().getPrice(), 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
          <td>
            <span class="badge bg-success px-3 py-2"
                  th:if="${row.getOrder().getOrderStatus().getName() == 'ƒê√£ duy·ªát'}"
                  data-bs-toggle="tooltip" title="ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c duy·ªát"
                  th:text="${row.getOrder().getOrderStatus().getName()}"></span>
            <span class="badge bg-warning text-dark px-3 py-2"
                  th:if="${row.getOrder().getOrderStatus().getName() == 'Ch·ªù x·ª≠ l√Ω'}"
                  data-bs-toggle="tooltip" title="ƒê∆°n h√†ng ƒëang ch·ªù x·ª≠ l√Ω"
                  th:text="${row.getOrder().getOrderStatus().getName()}"></span>
            <span class="badge bg-danger px-3 py-2"
                  th:if="${row.getOrder().getOrderStatus().getName() == 'ƒê√£ h·ªßy'}"
                  data-bs-toggle="tooltip" title="ƒê∆°n h√†ng ƒë√£ b·ªã h·ªßy"
                  th:text="${row.getOrder().getOrderStatus().getName()}"></span>
            <span class="badge bg-info px-3 py-2"
                  th:if="${row.getOrder().getOrderStatus().getName() != 'ƒê√£ duy·ªát' && row.getOrder().getOrderStatus().getName() != 'Ch·ªù x·ª≠ l√Ω' && row.getOrder().getOrderStatus().getName() != 'ƒê√£ h·ªßy'}"
                  th:text="${row.getOrder().getOrderStatus().getName()}"></span>
          </td>
          <td>
            <a th:href="@{'/order_statistic/dish/' + ${row.getDish().getId()}}" class="btn btn-sm btn-outline-primary">
              <i class="bi bi-eye"></i>
            </a>
          </td>
        </tr>
        </tbody>
      </table>
      </div>
    </div>
  </div>
</div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Tooltip init
  const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
  const tooltipList = [...tooltipTriggerList].map(el => new bootstrap.Tooltip(el))

  // T√¨m ki·∫øm
  document.getElementById('searchInput').addEventListener('keyup', function () {
    let filter = this.value.toLowerCase();
    let rows = document.querySelectorAll("#orderTable tbody tr");
    rows.forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(filter) ? "" : "none";
    });
  });

  // S·∫Øp x·∫øp
  function sortTable(colIndex) {
    let table = document.getElementById("orderTable");
    let switching = true, shouldSwitch, i;
    while (switching) {
      switching = false;
      let rows = table.rows;
      for (i = 1; i < (rows.length - 1); i++) {
        shouldSwitch = false;
        let x = rows[i].getElementsByTagName("TD")[colIndex];
        let y = rows[i + 1].getElementsByTagName("TD")[colIndex];
        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
          shouldSwitch = true;
          break;
        }
      }
      if (shouldSwitch) {
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
      }
    }
  }
</script>
</body>
</html>
