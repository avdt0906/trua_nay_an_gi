<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đối tác thân thiết</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS Dashboard -->
    <th:block th:replace="owner/restaurant/dashboard :: restaurant-content"></th:block>
</head>

<body>
<div class="wrapper">
    <!-- Sidebar -->
    <div th:include="owner/restaurant/dashboard :: restaurant-sidebar"></div>

    <!-- Main panel -->
    <div class="main-panel">
        <!-- Navbar -->
        <div th:include="owner/restaurant/dashboard :: restaurant-navbar"></div>

        <!-- Nội dung partner thân thiết -->
        <div class="content pt-2">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">

                        <!-- Thông tin nhà hàng -->
                        <div class="card mb-4 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Nhà hàng: <b th:text="${restaurant.name}"></b></h5>
                                <p class="card-text"><i class="fas fa-map-marker-alt me-1"></i> Địa chỉ: <span
                                        th:text="${restaurant.address}"></span></p>
                                <p class="card-text"><i class="fas fa-phone me-1"></i> Số điện thoại: <span
                                        th:text="${restaurant.phone}"></span></p>
                                <p class="card-text"><i class="fas fa-wallet me-1"></i> Số dư ví: <span
                                        class="text-success fw-bold"
                                        th:text="${#numbers.formatDecimal(restaurant.wallet,0,'COMMA',0,'POINT')} + ' VNĐ'"></span>
                                </p>
                                <p>
                                    Trạng thái đối tác:
                                    <span th:if="${restaurant.partnerRequest ?: false}" class="badge bg-warning">Chờ duyệt</span>
                                    <span th:if="${restaurant.isLongTermPartner ?: false}" class="badge bg-success">Đối tác thân thiết</span>
                                    <span th:if="${!(restaurant.partnerRequest ?: false) && !(restaurant.isLongTermPartner ?: false)}" class="badge bg-secondary">Chưa đăng ký</span>
                                </p>
                            </div>
                        </div>

                        <!-- Nút xem doanh thu -->
                        <div class="card mb-4 shadow-sm">
                            <div class="card-body">
                                <form th:action="@{/partner/revenue}" method="post">
                                    <input type="hidden" name="restaurantId" th:value="${restaurant.id}" />
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-chart-line me-1"></i> Xem doanh thu tháng hiện tại
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- Card doanh thu & đăng ký partner -->
                        <div th:if="${monthlyRevenue != null}" class="card mb-4 shadow-sm">
                            <div class="card-body">
                                <h5>Doanh thu tháng hiện tại:
                                    <span class="text-success fw-bold"
                                          th:text="${#numbers.formatDecimal(monthlyRevenue,0,'COMMA',0,'POINT')} + ' VNĐ'"></span>
                                </h5>

                                <div th:if="${canRegister}" class="mt-3">
                                    <form th:action="@{/partner/register}" method="post">
                                        <input type="hidden" name="restaurantId" th:value="${restaurant.id}" />
                                        <button class="btn btn-success btn-lg">
                                            <i class="fas fa-check-circle me-1"></i> Đăng ký đối tác thân thiết
                                        </button>
                                    </form>
                                </div>

                                <div th:if="${!canRegister}" class="mt-3">
                                    <p class="text-danger fw-bold">Doanh thu chưa đủ <b>100 triệu VNĐ</b> để đăng ký.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Chính sách & yêu cầu -->
                        <div class="card mb-4 border-info">
                            <div class="card-header bg-info text-white">Chính sách & Yêu cầu</div>
                            <div class="card-body">
                                <ul>
                                    <li>Nhà hàng phải có doanh thu tháng hiện tại > <b>100 triệu VNĐ</b> để đăng ký.</li>
                                    <li>Khi đăng ký, yêu cầu sẽ được gửi đến hệ thống và chờ phê duyệt bởi quản trị viên.</li>
                                    <li>Đối tác thân thiết sẽ nhận các ưu đãi đặc biệt từ nền tảng.</li>
                                    <li>Thông tin đăng ký phải chính xác và hợp lệ.</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Thông báo -->
                        <div th:if="${success}" class="alert alert-success mt-2" th:text="${success}"></div>
                        <div th:if="${error}" class="alert alert-danger mt-2" th:text="${error}"></div>

                    </div>
                </div>
            </div>
        </div>
    </div> <!-- main-panel -->
</div> <!-- wrapper -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Sidebar toggle
    document.addEventListener("DOMContentLoaded", function () {
        const sidebarToggle = document.getElementById('sidebarToggle');
        const wrapper = document.querySelector('.wrapper');
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                wrapper.classList.toggle('sidebar-collapsed');
                localStorage.setItem('sidebarState', wrapper.classList.contains('sidebar-collapsed') ? 'collapsed' : 'expanded');
            });
        }
        if (localStorage.getItem('sidebarState') === 'collapsed') {
            wrapper.classList.add('sidebar-collapsed');
        }
    });
</script>
</body>
</html>
