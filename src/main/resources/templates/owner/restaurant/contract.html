<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Hợp đồng thanh lý</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS chung dashboard -->
    <th:block th:replace="owner/restaurant/dashboard :: restaurant-content"></th:block>
</head>
<body>
<div class="wrapper">

    <!-- Sidebar -->
    <div th:include="owner/restaurant/dashboard :: restaurant-sidebar"></div>

    <!-- Main panel -->
    <div class="main-panel">
        <!-- Navbar -->
        <div th:include="owner/restaurant/dashboard :: restaurant-navbar"></div>

        <!-- Nội dung hợp đồng -->
        <div class="content pt-2">
            <div class="container contract-container">

                <h2 class="contract-title">HỢP ĐỒNG THANH LÝ</h2>

                <p>Giữa <strong th:text="${restaurant.name}">Tên Nhà hàng</strong> và <strong>ShopeeFood</strong></p>
                <p>Số hợp đồng: 
                    <strong th:text="${#strings.concat(restaurant.id,'-',#temporals.format(T(java.time.LocalDate).now(),'yyyyMMdd'))}">HD-001</strong>
                </p>
                <p>Ngày lập: 
                    <strong th:text="${#temporals.format(T(java.time.LocalDate).now(),'dd/MM/yyyy')}">01/01/2025</strong>
                </p>
                <hr>

                <div class="contract-section">
                    <h5>Điều 1: Điều kiện thanh lý</h5>
                    <ul>
                        <li>Nhà hàng chỉ được phép thanh lý hợp đồng khi <strong>doanh thu trong tháng ≥ 100.000.000 VNĐ</strong>.</li>
                        <li>Doanh thu sẽ được tính từ ngày 01 đến ngày cuối cùng của tháng hiện tại.</li>
                    </ul>
                </div>

                <div class="contract-section">
                    <h5>Điều 2: Rút tiền</h5>
                    <ul>
                        <li>Khi thanh lý hợp đồng, toàn bộ số dư ví của nhà hàng sẽ được rút về tài khoản đã đăng ký.</li>
                        <li>Nhà hàng đồng ý không khiếu nại về việc rút số dư sau khi thanh lý.</li>
                    </ul>
                </div>

                <div class="contract-section">
                    <h5>Điều 3: Cam kết</h5>
                    <ul>
                        <li>Nhà hàng cam kết tuân thủ các điều khoản trên.</li>
                        <li>Nhà hàng đồng ý chịu trách nhiệm pháp lý nếu cung cấp thông tin không chính xác.</li>
                    </ul>
                </div>

                <!-- Nếu doanh thu chưa đủ -->
                <div th:if="${!canTerminate}">
                    <div class="alert alert-danger alert-revenue">
                        Doanh thu tháng này hiện tại là 
                        <strong th:text="${#strings.concat(#numbers.formatDecimal(monthlyRevenue,0,'COMMA',0,'POINT'),' VNĐ')}"></strong>.
                        Chưa đủ 100.000.000 VNĐ, không thể thanh lý hợp đồng.
                    </div>
                    <a th:href="@{/restaurants/monthlyrevenue}" class="btn btn-info mb-3">Xem chi tiết doanh thu tháng này</a>
                </div>

                <!-- Nếu đủ doanh thu -->
                <div th:if="${canTerminate}">
                    <div class="form-check agreement-checkbox">
                        <input class="form-check-input" type="checkbox" id="agreeCheck" onclick="toggleButton()">
                        <label class="form-check-label" for="agreeCheck">
                            Tôi đã đọc và đồng ý với tất cả các điều khoản trên.
                        </label>
                    </div>

                    <form th:action="@{/restaurants/terminateContract}" method="post">
                        <input type="hidden" name="restaurantId" th:value="${restaurant.id}" />
                        <button class="btn btn-danger mt-3" id="confirmBtn" disabled>Xác nhận thanh lý hợp đồng</button>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    // Sidebar toggle
    document.addEventListener("DOMContentLoaded", function () {
        const sidebarToggle = document.getElementById('sidebarToggle');
        const wrapper = document.querySelector('.wrapper');
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                wrapper.classList.toggle('sidebar-collapsed');
                localStorage.setItem('sidebarState', wrapper.classList.contains('sidebar-collapsed') ? 'collapsed' : 'expanded');
            });
        }
        if (localStorage.getItem('sidebarState') === 'collapsed') {
            wrapper.classList.add('sidebar-collapsed');
        }
    });

    function toggleButton() {
        const checkbox = document.getElementById('agreeCheck');
        const button = document.getElementById('confirmBtn');
        button.disabled = !checkbox.checked;
    }
</script>

</body>
</html>
